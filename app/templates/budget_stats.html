{% extends "base.html" %}
{% block body %}
<h2 class="mb-4">Budget Statistics (Today)</h2>

<div class="table-responsive">
  <table class="table table-striped table-bordered table-sm">
    <thead>
      <tr>
        <th>Person</th>
        {% if table and table[0].categories %}
          {% for c in table[0].categories %}
            <th>{{ c.category }} Spent / Limit</th>
            <th>{{ c.category }} Remaining</th>
          {% endfor %}
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for row in table %}
        <tr>
          <td>{{ row.name }}</td>
          {% for c in row.categories %}
            <td>{{ c.spent }} / {{ c.limit }}</td>
            <td>{{ c.remaining }}</td>
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<hr class="my-4">

<div class="row">
  {% for donut in donut_data %}
    <div class="col-md-4 col-sm-6 mb-4 text-center">
      <h6>{{ donut.person }} â€“ {{ donut.category }}</h6>
      <canvas id="chart-{{ loop.index }}"></canvas>
      <script>
        new Chart(document.getElementById("chart-{{ loop.index }}"), {
          type: 'doughnut',
          data: {
            labels: ["Spent", "Remaining"],
            datasets: [{
              data: [{{ donut.spent }}, {{ donut.remaining }}],
              backgroundColor: ['#dc3545', '#28a745']
            }]
          },
          options: {
            plugins: {
              legend: { position: 'bottom' }
            }
          }
        });
      </script>
    </div>
  {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}